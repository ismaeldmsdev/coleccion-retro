<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üì¶ Colecci√≥n Retro</title>
  <style>
    /* TODO tu CSS tal cual, lo puedes pegar aqu√≠ sin tocarlo */
    /* ... (usa exactamente el CSS que ya ten√≠as) ... */
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéÆ Colecci√≥n Retro</h1>
      <p>Gestiona tu colecci√≥n de juegos</p>
    </header>

    <div class="card">
      <div id="mensaje" class="mensaje"></div>

      <form id="formulario">
        <div class="form-group">
          <label for="titulo">T√≠tulo del Juego:</label>
          <input type="text" id="titulo" required placeholder="Ej: Super Mario Bros 3">
        </div>

        <div class="form-group">
          <label for="consola">Consola:</label>
          <select id="consola" required>
            <option value="">-- Selecciona --</option>
            <option value="NES">NES</option>
            <option value="SNES">SNES</option>
            <option value="N64">Nintendo 64</option>
            <option value="GameBoy">Game Boy</option>
            <option value="PlayStation 1">PlayStation 1</option>
            <option value="PlayStation 2">PlayStation 2</option>
            <option value="Sega Genesis">Sega Genesis</option>
            <option value="Dreamcast">Dreamcast</option>
            <option value="Otro">Otro</option>
          </select>
        </div>

        <div class="form-group">
          <label for="a√±o">A√±o:</label>
          <input type="number" id="a√±o" placeholder="Ej: 1993">
        </div>

        <div class="form-group">
          <label for="estado">Estado:</label>
          <select id="estado" required>
            <option value="">-- Selecciona --</option>
            <option value="CIB">CIB (Completo en caja)</option>
            <option value="Suelto">Suelto</option>
            <option value="Completo">Completo (sin caja)</option>
            <option value="Caja y manual">Caja y manual</option>
          </select>
        </div>

        <div class="form-group">
          <label for="precio">Precio pagado (‚Ç¨):</label>
          <input type="number" id="precio" step="0.01" required placeholder="Ej: 10‚Ç¨">
        </div>

        <button type="submit">‚ûï A√±adir a colecci√≥n</button>
      </form>
    </div>

    <div class="card">
      <div id="stats" class="stats" style="display:none;">
        <div class="stats-item">
          <span>Total invertido:</span>
          <strong>‚Ç¨<span id="total">0.00</span></strong>
        </div>
        <div class="stats-item">
          <span>Juegos en colecci√≥n:</span>
          <strong id="cantidad">0</strong>
        </div>
      </div>

      <h2>üìã Mi colecci√≥n</h2>
      <div id="lista" class="loading">
        <p>‚è≥ Cargando datos...</p>
      </div>

      <button class="btn-danger" id="btnLimpiar">üóëÔ∏è Limpiar toda la colecci√≥n (solo visual)</button>
    </div>
  </div>

  <div id="modalExito" class="modal">
    <div class="modal-content">
      <div class="modal-icon">‚úÖ</div>
      <div class="modal-title">¬°Juego a√±adido!</div>
      <div class="modal-text">Se ha guardado correctamente</div>
    </div>
  </div>

  <script>
    let juegos = [];

    function cargarDatos() {
      google.script.run
        .withSuccessHandler((datos) => {
          juegos = datos || [];
          mostrarJuegos();
        })
        .getJuegos();
    }

    document.getElementById('formulario').addEventListener('submit', (e) => {
      e.preventDefault();

      const nuevoJuego = {
        titulo: document.getElementById('titulo').value,
        consola: document.getElementById('consola').value,
        a√±o: document.getElementById('a√±o').value,
        estado: document.getElementById('estado').value,
        precio: document.getElementById('precio').value
      };

      google.script.run
        .withSuccessHandler(() => {
          const modal = document.getElementById('modalExito');
          modal.classList.add('show');
          setTimeout(() => {
            modal.classList.remove('show');
          }, 1500);

          document.getElementById('formulario').reset();
          cargarDatos();
        })
        .withFailureHandler((err) => {
          console.error(err);
          mostrarMensaje('‚ö†Ô∏è Error al guardar', 'error');
        })
        .addJuego(nuevoJuego);
    });

    document.getElementById('btnLimpiar').addEventListener('click', () => {
      if (juegos.length === 0) {
        mostrarMensaje('‚ö†Ô∏è No hay juegos para borrar (solo visualmente)', 'error');
        return;
      }
      if (confirm('Esto solo limpia la vista, no borra de la hoja. ¬øContinuar?')) {
        juegos = [];
        mostrarJuegos();
        mostrarMensaje('üóëÔ∏è Vista limpiada (no se ha borrado la hoja)', 'success');
      }
    });

    function mostrarMensaje(texto, tipo) {
      const mensaje = document.getElementById('mensaje');
      mensaje.textContent = texto;
      mensaje.className = `mensaje ${tipo}`;
    }

    function mostrarJuegos() {
      const lista = document.getElementById('lista');
      const stats = document.getElementById('stats');

      if (!juegos || juegos.length === 0) {
        lista.innerHTML = '<p class="empty">A√∫n no hay juegos. ¬°A√±ade el primero!</p>';
        stats.style.display = 'none';
        return;
      }

      let html = '';
      let total = 0;

      juegos.forEach((juego, index) => {
        total += Number(juego.precio) || 0;
        html += `
          <div class="juego">
            <div class="juego-content">
              <div class="juego-titulo">${juego.titulo}</div>
              <div class="juego-info">
                <strong>${juego.consola}</strong> ‚Ä¢ ${juego.a√±o} ‚Ä¢ ${juego.estado}
              </div>
              <div class="juego-precio">üí∞ ‚Ç¨${Number(juego.precio).toFixed(2)}</div>
            </div>
          </div>`;
      });

      lista.innerHTML = html;
      document.getElementById('total').textContent = total.toFixed(2);
      document.getElementById('cantidad').textContent = juegos.length;
      stats.style.display = 'block';
    }

    // Cargar datos al abrir la app
    cargarDatos();
  </script>
</body>
</html>
